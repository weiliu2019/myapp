(function(t){function e(e){for(var i,r,c=e[0],s=e[1],l=e[2],u=0,f=[];u<c.length;u++)r=c[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&f.push(a[r][0]),a[r]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i]);d&&d(e);while(f.length)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],i=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(i=!1)}i&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},a={plan_detail:0},o=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var d=s;o.push([30,"chunk-vendors","chunk-common"]),n()})({30:function(t,e,n){t.exports=n("cd9c")},cd9c:function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("page",{ref:"page",staticClass:"plan-detail-page common-page",attrs:{headerHeightVW:t.headerHeightVW,scrollbar:""},on:{"on-ready":t.onReady,"on-show":t.onShow}},[n("van-nav-bar",{attrs:{slot:"header",id:"header",title:"工单详情","left-arrow":""},on:{"click-left":t.onClickLeft},slot:"header"}),n("div",{staticClass:"detail-container"},[n("div",{staticClass:"detail-header"},[n("div",{staticClass:"detail-cell"},[n("div",{staticClass:"detail-no"},[t._v(t._s(t.detail.no))]),n("div",{staticClass:"detail-status"},[t._v(t._s(t.statusEnum[t.detail.status]))])]),n("div",{staticClass:"detail-cell"},[n("div",{staticClass:"detail-time1"},[t._v("计划完成时间: "+t._s(t.detail.finishTime)+"\n\n          "),n("span",{staticStyle:{color:"red"}},[t._v(t._s(t.detail.expireTime))])])]),n("div",{staticClass:"detail-cell"},[n("div",{staticClass:"item-address"},[t._v("巡检点："+t._s(t.detail.line)+" / "+t._s(t.detail.station))])]),n("div",{staticClass:"detail-cell"},[n("div",{staticClass:"item-time1"},[t._v("检修周期："+t._s(t.detail.planType))])])])]),n("van-cell-group",{staticStyle:{"margin-top":"12px"}},t._l(t.detail.formList,(function(e,i){return n("van-cell",{key:e.id,attrs:{clickable:"",title:e.title,value:t.formStatusEnum[e.status],"is-link":""},on:{click:function(n){return t.handleForm(e,i)}}})})),1),n("van-cell-group",[n("van-cell",{attrs:{title:"维修过程","is-link":"",clickable:""},on:{click:t.handleRecord}})],1),n("div",{staticClass:"blank-empty"}),n("template",{slot:"blank"},["assigned"==t.detail.status?n("div",{staticClass:"footer-action"},[n("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},nativeOn:{click:function(e){return t.handleReceive(e)}}},[t._v("接报")])],1):t._e(),"pending_sign"==t.detail.status?n("div",{staticClass:"footer-action"},[n("div",{staticClass:"action-item",on:{click:t.handleForward}},[n("i",{staticClass:"action-item-icon icon-zhuanfa"}),n("span",[t._v("转发")])]),n("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},nativeOn:{click:function(e){return t.handleSign(e)}}},[t._v("签到")])],1):t._e(),"waiting_repair"==t.detail.status?n("div",{staticClass:"footer-action"},[n("div",{staticClass:"action-item",on:{click:t.handleForward}},[n("i",{staticClass:"action-item-icon icon-zhuanfa"}),n("span",[t._v("转发")])]),n("van-button",{staticClass:"action-item-main",attrs:{disabled:!t.canSubmit,color:"#108EE9"},nativeOn:{click:function(e){return t.handleSubmit(e)}}},[t._v("提交")])],1):t._e()])],2)},a=[],o=(n("1c01"),n("58b2"),n("8e6e"),n("f3e2"),n("d25f"),n("ac6a"),n("456d"),n("6d67"),n("bd86")),r=n("9973"),c=n("c03e"),s=n("365c"),l=n("8149"),d=n("698a"),u=n("08f3"),f=n("0e5c");function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(o["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={components:{Page:r["a"]},data:function(){return{headerHeightVW:0,id:null,detail:{},online:!1,user:JSON.parse(localStorage.getItem("user")),statusEnum:u["e"],formStatusEnum:u["b"],canSubmit:!1}},methods:{onReady:function(t,e){this.header=t,this.headerHeightVW=100*(this.header.h+1)/this.header.w,this.id=c["a"].getParam("id"),this.loadDetail()},onShow:function(){this.loadDetail()},onClickLeft:function(){c["a"].back()},handleRepair:function(){c["a"].open("repair",{orderid:this.id})},handleSign:function(){c["a"].open("photosign",{orderid:this.id})},loadDetail:function(){var t=this;this.$toast.loading({duration:0,loadingType:"spinner"}),l["a"].getOrderDetail(this.id).then((function(e){if(e.id==t.id){t.online=!1,t.detail=p({},e),t.canSubmit=d["a"].connection();for(var n=0;n<t.detail.formList.length;n++)if("executed"!=t.detail.formList[n].status){t.canSubmit=!1;break}t.$toast.clear()}else t.online=!0,s["a"].getPlanDetail({id:t.id}).then((function(e){t.detail=p({},e),"waiting_repair"==t.detail.status||"pending_sign"==t.detail.status?l["a"].saveOrder(p({},t.detail,{type:2})).then((function(){t.$toast.clear()})):t.$toast.clear()})).catch((function(e){t.$toast(e)}))}))},handleReceive:function(){var t=this;this.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在接报..."}),s["a"].receivePlanOrder({id:this.detail.id}).then((function(){l["a"].saveOrder(p({},t.detail,{status:"pending_sign",type:2})).then((function(){t.$toast.clear(),t.loadDetail()})).catch((function(e){t.$toast(e)}))})).catch((function(e){t.$toast(e)}))},handleForward:function(){d["a"].connection()?c["a"].open("organization",{id:this.id,type:2}):alert("网络无法连接，转发请求失败")},handleClearup:function(){"none"==api.connectionType?alert("网络无法连接，销项请求失败"):c["a"].open("clearup",{orderid:this.id})},handleHang:function(){"none"==api.connectionType?alert("网络无法连接，挂起请求失败"):c["a"].open("hang",{orderid:this.id})},handleForm:function(t,e){var n="waiting_repair"!=this.detail.status;c["a"].open("form_detail",{id:this.id,index:e,readonly:n})},handleRecord:function(){c["a"].open("orderRecord",{id:this.detail.id,type:2})},handleSubmit:function(){var t=this;d["a"].connection()&&l["a"].getOrderDetail(this.id).then((function(e){e.signPhoto||(e.signPhoto=[]),Object(f["b"])(e.signPhoto.map((function(t){return{url:t}}))).then((function(n){e.signPhoto=n,s["a"].uploadPlan(p({},e)).catch((function(n){s["a"].submitPlan({id:t.id,formList:e.formList}).then((function(){l["a"].removeOrder(t.id).then((function(){c["a"].back()}))})).catch((function(e){t.$toast(e)}))}))}))}))}}},g=v,b=(n("ecca"),n("2877")),m=Object(b["a"])(g,i,a,!1,null,null,null),y=m.exports,O=n("a1db");O["a"].init(y)},ecca:function(t,e,n){"use strict";var i=n("f193"),a=n.n(i);a.a},f193:function(t,e,n){}});
//# sourceMappingURL=plan_detail.53e9c64b.js.map