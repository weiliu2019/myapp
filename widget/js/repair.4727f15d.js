(function(e){function t(t){for(var o,l,r=t[0],s=t[1],c=t[2],u=0,p=[];u<r.length;u++)l=r[u],Object.prototype.hasOwnProperty.call(a,l)&&a[l]&&p.push(a[l][0]),a[l]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);d&&d(t);while(p.length)p.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],o=!0,r=1;r<i.length;r++){var s=i[r];0!==a[s]&&(o=!1)}o&&(n.splice(t--,1),e=l(l.s=i[0]))}return e}var o={},a={repair:0},n=[];function l(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.m=e,l.c=o,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(i,o,function(t){return e[t]}.bind(null,o));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],s=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=s;n.push([36,"chunk-vendors","chunk-common"]),i()})({"341e":function(e,t,i){"use strict";i.r(t);i("cadf"),i("551c"),i("f751"),i("097d");var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("page",{ref:"page",staticClass:"repair-page common-page",attrs:{headerHeightVW:e.headerHeightVW,scrollbar:""},on:{"on-ready":e.onReady,"on-show":e.onShow}},[o("van-nav-bar",{attrs:{slot:"header",id:"header",title:"维修详情","left-arrow":""},on:{"click-left":e.onClickLeft},slot:"header"}),o("van-cell-group",[o("van-cell",{attrs:{title:"选择维修结果","is-link":"",clickable:""},on:{click:e.handleSelectResult}},[o("span",[e._v(e._s(e.result&&e.result.name))])]),o("van-cell",{attrs:{title:"故障设备","is-link":"",clickable:""},on:{click:e.handleSelectDevice}},[o("span",[e._v(e._s(e.deviceCategory&&e.deviceCategory.name)+" / "+e._s(e.device&&e.device.name))])]),o("van-cell",{attrs:{title:"故障分类","is-link":"",clickable:""},on:{click:e.handleSelectReason}},[o("span",[e._v(e._s(e.reason&&e.reason.name))])]),o("van-cell",{attrs:{title:"故障等级","is-link":"",clickable:""},on:{click:e.handleSelectLevel}},[o("span",[e._v(e._s(e.level&&e.level.name))])])],1),o("van-cell-group",[o("van-cell",{attrs:{title:"维修内容(必填)："}}),o("van-field",{attrs:{placeholder:"请填写维修内容",type:"textarea",rows:2,autosize:""},model:{value:e.repairContent,callback:function(t){e.repairContent=t},expression:"repairContent"}})],1),o("van-cell-group",[o("van-cell",{attrs:{title:"备注："}}),o("van-field",{attrs:{placeholder:"请填写备注（选填）",type:"textarea",rows:2,autosize:""},model:{value:e.repairRemark,callback:function(t){e.repairRemark=t},expression:"repairRemark"}})],1),o("van-cell-group",[o("van-cell",{attrs:{title:"图像："}}),o("div",{staticClass:"images-container"},[e._l(e.imageList,(function(t,i){return o("div",{key:i,staticClass:"image-item-show",on:{click:function(t){return e.handlePlayImages(i)}}},[o("auto-image",{staticStyle:{"margin-bottom":"12px","margin-left":"12px"},attrs:{src:t.url,width:108,height:108}}),o("div",{staticClass:"image-remove",on:{click:function(t){return t.stopPropagation(),e.handleImageRemove(i)}}})],1)})),o("div",{staticClass:"image-item",staticStyle:{background:"#fff"},on:{click:function(t){return t.stopPropagation(),e.handlePhoto1(t)}}},[o("img",{attrs:{src:i("4857")}})])],2)],1),o("van-cell-group",[o("van-cell",{attrs:{title:"视频："}}),o("div",{staticClass:"images-container"},[e._l(e.videoList,(function(t,a){return o("div",{key:a,staticClass:"image-item-show",on:{click:function(i){return e.handlePlayVideo(t)}}},[o("img",{staticClass:"img-video",attrs:{src:i("f0f8")}}),o("div",{staticClass:"image-remove",on:{click:function(t){return t.stopPropagation(),e.handleVideoRemove(a)}}})])})),o("div",{staticClass:"image-item",staticStyle:{background:"#fff"},on:{click:function(t){return t.stopPropagation(),e.handlePhoto2(t)}}},[o("img",{attrs:{src:i("4857")}})])],2)],1),o("div",{staticClass:"blank-empty"}),o("template",{slot:"blank"},[o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main btn-save",attrs:{color:"rgba(16, 142, 233, 0.15)"},on:{click:e.handleSave}},[e._v("保存")]),o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.handleSubmit}},[e._v("提交")])],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.reasonShow,callback:function(t){e.reasonShow=t},expression:"reasonShow"}},[o("div",{staticClass:"title"},[e._v("\n        选择故障分类\n      ")]),e.reasonShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.reasonRadio.id,callback:function(t){e.$set(e.reasonRadio,"id",t)},expression:"reasonRadio.id"}},[o("van-cell-group",e._l(e.reasonOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.reasonRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onReasonSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.typeShow,callback:function(t){e.typeShow=t},expression:"typeShow"}},[o("div",{staticClass:"title"},[e._v("\n        选择故障类型\n      ")]),e.typeShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.typeRadio.id,callback:function(t){e.$set(e.typeRadio,"id",t)},expression:"typeRadio.id"}},[o("van-cell-group",e._l(e.typeOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.typeRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onTypeSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.levelShow,callback:function(t){e.levelShow=t},expression:"levelShow"}},[o("div",{staticClass:"title"},[e._v("\n        选择故障等级\n      ")]),e.levelShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.levelRadio.id,callback:function(t){e.$set(e.levelRadio,"id",t)},expression:"levelRadio.id"}},[o("van-cell-group",e._l(e.levelOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.levelRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onLevelSelect}},[e._v("确定")])],1)],1),o("van-action-sheet",{attrs:{actions:e.resultOptoins,"close-on-click-action":""},on:{select:e.onResultSelect},model:{value:e.resultShow,callback:function(t){e.resultShow=t},expression:"resultShow"}}),o("van-dialog",{attrs:{"show-cancel-button":"","before-close":e.beforeClose},model:{value:e.editShow,callback:function(t){e.editShow=t},expression:"editShow"}},[o("van-cell",{attrs:{title:"描述"}}),o("van-field",{ref:"desInput",attrs:{type:"textarea",clearable:!0},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1)],1)],2)},a=[],n=(i("1c01"),i("58b2"),i("8e6e"),i("f3e2"),i("d25f"),i("ac6a"),i("456d"),i("6d67"),i("bd86")),l=i("9973"),r=i("4e1b"),s=i("c03e"),c=i("4ff5"),d=i("8149"),u=i("365c"),p=i("c1df"),v=i.n(p),h=i("0e5c");function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(Object(i),!0).forEach((function(t){Object(n["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var g={components:{Page:l["a"],AScroll:r["a"],AutoImage:c["a"]},data:function(){return{headerHeightVW:0,levelOptions:JSON.parse(localStorage.getItem("level_options")),reasonOptions:JSON.parse(localStorage.getItem("reason_options")),typeOptions:JSON.parse(localStorage.getItem("type_options")),resultOptoins:[{id:1,name:"临时维修"},{id:2,name:"完全修复"}],orderid:null,level:null,device:null,deviceCategory:null,type:null,reason:null,result:{id:1,name:"临时维修"},resultShow:!1,reasonShow:!1,reasonRadio:null,typeShow:!1,typeRadio:null,levelShow:!1,levelRadio:null,imageList:[],videoList:[],UIPhotoViewer:null,editShow:!1,description:"",imgFile:"",repairContent:"",repairRemark:"",orderDetail:null,imageFilter:null,videoCompression:null}},methods:{onReady:function(e,t){this.header=e,this.headerHeightVW=100*(this.header.h+1)/this.header.w,this.orderid=s["a"].getParam("orderid"),this.loadOrderDetail()},onShow:function(){localStorage.getItem("device_select")&&(this.device=JSON.parse(localStorage.getItem("device_select")),localStorage.setItem("device_select","")),localStorage.getItem("device_type_select")&&(this.deviceCategory=JSON.parse(localStorage.getItem("device_type_select")),localStorage.setItem("device_type_select",""))},loadOrderDetail:function(){var e=this;d["a"].getOrderDetail(this.orderid).then((function(t){e.level=t.level,e.device=t.device,e.deviceCategory=t.deviceCategory,e.type=t.faultType,e.reason=t.reason,e.result=1==t.repairResult?{id:1,name:"临时维修"}:{id:2,name:"完全修复"},e.repairContent=t.repairContent,e.repairRemark=t.repairRemark,e.imageList=t.repairImages||[],e.videoList=t.repairVideos||[],e.orderDetail=t,localStorage.setItem("device_select",JSON.stringify(e.device))}))},onClickLeft:function(){s["a"].back()},handleSelectResult:function(){this.resultShow=!0},onResultSelect:function(e){this.result=e},handleSelectReason:function(){this.reasonShow=!0,this.reasonRadio=m({},this.reason)},onReasonSelect:function(){this.reason=m({},this.reasonRadio),this.reasonShow=!1},handleSelectType:function(){this.typeShow=!0,this.typeRadio=m({},this.type)},onTypeSelect:function(){this.type=m({},this.typeRadio),this.typeShow=!1},handleSelectLevel:function(){this.levelShow=!0,this.levelRadio=m({},this.level)},onLevelSelect:function(){this.level=m({},this.levelRadio),this.levelShow=!1},handlePhoto1:function(){var e=this;api.actionSheet({buttons:["打开照相机","从相册获取"]},(function(t,i){var o=t.buttonIndex,a="";1===o?a="camera":2===o&&(a="album"),a&&api.getPicture({sourceType:a,destinationType:"url",preview:!0,mediaValue:"pic"},(function(t,i){t.data&&(e.imgFile=t.data,e.description="",e.editShow=!0,setTimeout((function(){e.$refs.desInput.focus()}),200))}))}))},handlePhoto2:function(){var e=this;api.actionSheet({buttons:["打开照相机","从相册获取"]},(function(t,i){var o=t.buttonIndex,a="";1===o?a="camera":2===o&&(a="album"),a&&api.getPicture({sourceType:a,destinationType:"url",preview:!0,quality:100,videoQuality:"high",mediaValue:"video",saveToPhotoAlbum:!0},(function(t,i){t.data&&("ios"==api.systemType?(e.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在压缩..."}),e.videoCompression||(e.videoCompression=api.require("videoCompression")),e.videoCompression.compression({path:t.data,quality:"medium"},(function(t,i){"completed"==t.eventType&&(e.videoList.push({url:t.path}),e.$toast.clear())}))):e.videoList.push({url:t.data}))}))}))},beforeClose:function(e,t){"confirm"===e?this.imageList.push({url:this.imgFile,description:this.description}):this.imageList.push({url:this.imgFile,description:""}),t()},handleVideoRemove:function(e){this.videoList.splice(e,1)},handleImageRemove:function(e){this.imageList.splice(e,1)},handlePlayVideo:function(e){api.openVideo({url:e.url})},handlePlayImages:function(e){localStorage.setItem("photos",JSON.stringify(this.imageList)),s["a"].open("photoViewer",{index:e})},handleSelectDevice:function(){s["a"].open("device")},handleSave:function(){var e=this;this.onSave().then((function(){e.$toast("保存成功")}))},handleSubmit:function(){var e=this;this.onSave().then((function(t){"none"==api.connectionType?alert("维修结果已保存，请在有网的时候提交！"):(e.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在提交..."}),t.signPhoto||(t.signPhoto=[]),Object(h["b"])(t.signPhoto.map((function(e){return{url:e}}))).then((function(i){t.signPhoto=i,Object(h["b"])(t.repairImages).then((function(i){t.repairImages=i,Object(h["c"])(t.repairVideos).then((function(i){t.repairVideos=i,u["a"].uploadOrder(t).then((function(){u["a"].submitOrder({id:t.id}).then((function(t){d["a"].removeOrder(e.orderid).then((function(){s["a"].back()}))})).catch((function(t){e.$toast(t)}))})).catch((function(t){e.$toast(t)}))}))}))})))}))},onSave:function(){var e=this;return new Promise((function(t,i){d["a"].getOrderDetail(e.orderid).then((function(i){var o=m({},i,{repairResult:e.result.id,device:e.device,deviceCategory:e.deviceCategory,reason:e.reason,faultType:e.type,level:e.level,repairContent:e.repairContent,repairRemark:e.repairRemark,repairTime:v()().format("YYYY-MM-DD HH:mm:ss"),repairImages:e.imageList,repairVideos:e.videoList});d["a"].updateOrder(o).then((function(){t(o)}))}))}))}}},b=g,y=(i("b83f"),i("2877")),S=Object(y["a"])(b,o,a,!1,null,null,null),k=S.exports,w=i("a1db");w["a"].init(k)},36:function(e,t,i){e.exports=i("341e")},7543:function(e,t,i){},b83f:function(e,t,i){"use strict";var o=i("7543"),a=i.n(o);a.a}});
//# sourceMappingURL=repair.4727f15d.js.map