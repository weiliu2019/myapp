(function(e){function t(t){for(var a,n,l=t[0],s=t[1],c=t[2],p=0,f=[];p<l.length;p++)n=l[p],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&f.push(r[n][0]),r[n]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,c||[]),o()}function o(){for(var e,t=0;t<i.length;t++){for(var o=i[t],a=!0,l=1;l<o.length;l++){var s=o[l];0!==r[s]&&(a=!1)}a&&(i.splice(t--,1),e=n(n.s=o[0]))}return e}var a={},r={createTrouble:0},i=[];function n(t){if(a[t])return a[t].exports;var o=a[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=a,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;i.push([8,"chunk-vendors","chunk-common"]),o()})({"5ccf":function(e,t,o){"use strict";o.r(t);o("cadf"),o("551c"),o("f751"),o("097d");var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page",{ref:"page",staticClass:"create-page common-page",attrs:{headerHeightVW:e.headerHeightVW,scrollbar:""},on:{"on-ready":e.onReady,"on-show":e.onShow}},[a("van-nav-bar",{attrs:{slot:"header",id:"header",title:"发现隐患","left-arrow":""},on:{"click-left":e.onClickLeft},slot:"header"}),a("van-cell-group",[a("van-cell",{attrs:{required:"",title:"排查日期：","is-link":"",clickable:""},on:{click:e.handleSelectExameDate}},[a("span",[e._v(e._s(e.form.exameDate||"请选择"))])]),a("van-cell",{attrs:{required:"",title:"检查部门：","is-link":"",clickable:""},on:{click:e.handleSelectDepartment}},[a("span",[e._v(e._s(e.form.exameDepartment&&e.form.exameDepartment.name||"请选择"))])]),a("van-cell",{attrs:{required:"",title:"检查人：","is-link":"",clickable:""},on:{click:e.handleSelectUser}},[a("span",[e._v(e._s(e.form.exameUser.map((function(e){return e.name})).join("、")||"请选择"))])])],1),a("van-cell-group",[a("van-cell",{attrs:{title:"所属专业","is-link":"",clickable:""},on:{click:e.handleSelectProfession}},[a("span",[e._v(e._s(e.form.profession&&e.form.profession.name))])]),a("van-cell",{attrs:{title:"故障设备分类","is-link":"",clickable:""},on:{click:e.handleSelectDeviceCategory}},[a("span",[e._v(e._s(e.form.deviceCategory&&e.form.deviceCategory.name))])]),a("van-cell",{staticClass:"detail-title",attrs:{title:"具体位置："}}),a("van-field",{attrs:{placeholder:"请填写",type:"textarea",rows:1,autosize:""},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}}),a("van-cell",{attrs:{title:"隐患级别：","is-link":"",clickable:""},on:{click:e.handleSelectLevel}},[a("span",[e._v(e._s(e.form.troubleLevel&&e.form.troubleLevel.name||"请选择"))])]),a("van-cell",{attrs:{required:"",title:"隐患类型：","is-link":"",clickable:""},on:{click:e.handleSelectType}},[a("span",[e._v(e._s(e.form.troubleType&&e.form.troubleType.name||"请选择"))])]),a("van-cell",{staticClass:"detail-title",attrs:{required:"",title:"隐患内容："}}),a("van-field",{attrs:{placeholder:"请填写隐患内容",type:"textarea",rows:2,autosize:""},model:{value:e.form.troubleContent,callback:function(t){e.$set(e.form,"troubleContent",t)},expression:"form.troubleContent"}}),a("van-cell",{staticClass:"detail-title",attrs:{title:"危害及影响："}}),a("van-field",{attrs:{placeholder:"请填写",type:"textarea",rows:2,autosize:""},model:{value:e.form.troubleSuggest,callback:function(t){e.$set(e.form,"troubleSuggest",t)},expression:"form.troubleSuggest"}})],1),a("van-cell-group",[a("van-cell",{staticClass:"detail-title",attrs:{title:"临时解决措施："}}),a("van-field",{attrs:{placeholder:"请填写",type:"textarea",rows:2,autosize:""},model:{value:e.form.tempSolution,callback:function(t){e.$set(e.form,"tempSolution",t)},expression:"form.tempSolution"}}),a("van-cell",{staticClass:"detail-title",attrs:{title:"最终解决措施："}}),a("van-field",{attrs:{placeholder:"请填写",type:"textarea",rows:2,autosize:""},model:{value:e.form.finalSolution,callback:function(t){e.$set(e.form,"finalSolution",t)},expression:"form.finalSolution"}})],1),a("van-cell-group",[a("van-cell",{attrs:{required:"",title:"所属工区（站）：","is-link":"",clickable:""},on:{click:e.handleSelectDepartment2}},[a("span",[e._v(e._s(e.form.dutyDepartment&&e.form.dutyDepartment.name||"请选择"))])]),a("van-cell",{attrs:{title:"工区：","is-link":"",clickable:""},on:{click:e.handleSelectArea}},[a("span",[e._v(e._s(e.form.dutyArea&&e.form.dutyArea.name||"请选择"))])])],1),a("van-cell-group",[a("van-cell",{staticClass:"detail-title",attrs:{title:"备注："}}),a("van-field",{attrs:{placeholder:"请填写",type:"textarea",rows:2,autosize:""},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),a("van-cell-group",[a("van-cell",{staticClass:"detail-title",attrs:{title:"现场情况："}}),a("div",{staticClass:"images-container"},[e._l(e.form.imageList,(function(t,o){return a("div",{key:o,staticClass:"image-item-show",on:{click:function(t){return e.handlePlayImages(o)}}},[a("auto-image",{staticStyle:{"margin-bottom":"12px","margin-left":"12px"},attrs:{src:t.url,width:108,height:108}}),a("div",{staticClass:"image-remove",on:{click:function(t){return t.stopPropagation(),e.handleImageRemove(o)}}})],1)})),a("div",{staticClass:"image-item",staticStyle:{background:"#fff"},on:{click:function(t){return t.stopPropagation(),e.handlePhoto1(t)}}},[a("img",{attrs:{src:o("4857")}})])],2)],1),a("div",{staticClass:"blank-empty"}),a("template",{slot:"blank"},[a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.handleSubmit}},[e._v("提交")])],1),a("van-popup",{staticClass:"time-popup",attrs:{position:"bottom","lock-scroll":!1,round:""},model:{value:e.dateShow,callback:function(t){e.dateShow=t},expression:"dateShow"}},[a("van-datetime-picker",{attrs:{type:"date"},on:{confirm:e.handleDateConfirm,cancel:function(t){e.dateShow=!1}},model:{value:e.currentTime,callback:function(t){e.currentTime=t},expression:"currentTime"}})],1),a("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.departmentShow,callback:function(t){e.departmentShow=t},expression:"departmentShow"}},[a("div",{staticClass:"title"},[e._v("选择部门")]),e.departmentShow?a("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[a("van-radio-group",{model:{value:e.departmentRadio.id,callback:function(t){e.$set(e.departmentRadio,"id",t)},expression:"departmentRadio.id"}},[a("van-cell-group",e._l(e.departmentOptions,(function(t,o){return a("van-cell",{key:o,attrs:{title:t.name,clickable:""},on:{click:function(o){e.departmentRadio=Object.assign({},t)}}},[a("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onDepartmentSelect}},[e._v("确定")])],1)],1),a("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.typeShow,callback:function(t){e.typeShow=t},expression:"typeShow"}},[a("div",{staticClass:"title"},[e._v("选择隐患类型")]),e.typeShow?a("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[a("van-radio-group",{model:{value:e.typeRadio.id,callback:function(t){e.$set(e.typeRadio,"id",t)},expression:"typeRadio.id"}},[a("van-cell-group",e._l(e.typeOptions,(function(t,o){return a("van-cell",{key:o,attrs:{title:t.name,clickable:""},on:{click:function(o){e.typeRadio=Object.assign({},t)}}},[a("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onTypeSelect}},[e._v("确定")])],1)],1),a("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.levelShow,callback:function(t){e.levelShow=t},expression:"levelShow"}},[a("div",{staticClass:"title"},[e._v("选择隐患级别")]),e.levelShow?a("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[a("van-radio-group",{model:{value:e.levelRadio.id,callback:function(t){e.$set(e.levelRadio,"id",t)},expression:"levelRadio.id"}},[a("van-cell-group",e._l(e.levelOptions,(function(t,o){return a("van-cell",{key:o,attrs:{title:t.name,clickable:""},on:{click:function(o){e.levelRadio=Object.assign({},t)}}},[a("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onLevelSelect}},[e._v("确定")])],1)],1),a("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.areaShow,callback:function(t){e.areaShow=t},expression:"areaShow"}},[a("div",{staticClass:"title"},[e._v("选择工区")]),e.areaShow?a("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[a("van-radio-group",{model:{value:e.areaRadio.id,callback:function(t){e.$set(e.areaRadio,"id",t)},expression:"areaRadio.id"}},[a("van-cell-group",e._l(e.areaOptions,(function(t,o){return a("van-cell",{key:o,attrs:{title:t.name,clickable:""},on:{click:function(o){e.areaRadio=Object.assign({},t)}}},[a("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onAreaSelect}},[e._v("确定")])],1)],1),a("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.userShow,callback:function(t){e.userShow=t},expression:"userShow"}},[a("div",{staticClass:"title"},[e._v("选择检查人")]),e.userShow?a("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[a("van-checkbox-group",{model:{value:e.userCheckbox,callback:function(t){e.userCheckbox=t},expression:"userCheckbox"}},[a("van-cell-group",e._l(e.userOptions,(function(t,o){return a("van-cell",{key:o,attrs:{title:t.name,clickable:""},on:{click:function(t){return e.$refs.userCheckbox[o].toggle()}}},[a("van-checkbox",{ref:"userCheckbox",refInFor:!0,attrs:{slot:"right-icon",name:t},slot:"right-icon"})],1)})),1)],1)],1):e._e(),a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onUserSelect}},[e._v("确定")])],1)],1),a("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.professionShow,callback:function(t){e.professionShow=t},expression:"professionShow"}},[a("div",{staticClass:"title"},[e._v("选择所属专业")]),e.professionShow?a("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[a("van-radio-group",{model:{value:e.professionRadio.id,callback:function(t){e.$set(e.professionRadio,"id",t)},expression:"professionRadio.id"}},[a("van-cell-group",e._l(e.professionOptions,(function(t,o){return a("van-cell",{key:o,attrs:{title:t.name,clickable:""},on:{click:function(o){e.professionRadio=Object.assign({},t)}}},[a("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),a("div",{staticClass:"footer-action"},[a("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onProfessionSelect}},[e._v("确定")])],1)],1)],1)],2)},r=[],i=(o("1c01"),o("58b2"),o("8e6e"),o("f3e2"),o("d25f"),o("ac6a"),o("456d"),o("75fc")),n=o("bd86"),l=(o("6d67"),o("9973")),s=o("4e1b"),c=o("c03e"),u=o("4ff5"),p=(o("8149"),o("365c")),f=o("c1df"),m=o.n(f),d=(o("698a"),o("0e5c"));function h(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var b={components:{Page:l["a"],AScroll:s["a"],AutoImage:u["a"]},data:function(){return{headerHeightVW:0,typeOptions:JSON.parse(localStorage.getItem("problem_category")),levelOptions:[{id:"commonly",name:"一般"},{id:"great",name:"重大"}],departmentOptions:[],userOptions:[],areaOptions:[],professionOptions:JSON.parse(localStorage.getItem("problem_profession")),imageFilter:null,currentTime:new Date,dateShow:!1,departmentShow:!1,departmentRadio:void 0,departmentType:1,userShow:!1,userCheckbox:[],typeShow:!1,typeRadio:void 0,levelShow:!1,levelRadio:void 0,areaShow:!1,areaRadio:void 0,professionShow:!1,professionRadio:null,form:{exameDate:"",exameDepartment:"",exameUser:[],troubleType:"",troubleContent:"",troubleSuggest:"",dutyDepartment:"",dutyArea:"",imageList:[],deviceCategory:null,profession:null,address:"",troubleLevel:"",tempSolution:"",finalSolution:"",remark:""}}},methods:{onReady:function(e,t){var o=this;this.header=e,this.headerHeightVW=100*(this.header.h+1)/this.header.w,p["a"].getTroubleDepartment().then((function(e){o.departmentOptions=e}))},onShow:function(){if(localStorage.getItem("category_select")){var e=JSON.parse(localStorage.getItem("category_select"));this.form.deviceCategory=e[e.length-1]}},onClickLeft:function(){c["a"].back()},handleSubmit:function(){var e=this;this.form.exameDate&&this.form.exameDepartment&&this.form.exameUser&&this.form.troubleType&&this.form.troubleContent&&this.form.dutyDepartment?(this.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在提交..."}),Object(d["b"])(this.form.imageList).then((function(t){e.form.imageList=t,p["a"].createTrouble({date:e.form.exameDate,department:e.form.exameDepartment?e.form.exameDepartment.id:"",user:e.form.exameUser.map((function(e){return e.id})).join(","),profession:e.form.profession?e.form.profession.id:"",deviceCategory:e.form.deviceCategory?e.form.deviceCategory.id:"",address:e.form.address,content:e.form.troubleContent,harm:e.form.troubleSuggest,tempSolution:e.form.tempSolution,finalSolution:e.form.finalSolution,level:e.form.level?e.form.level.id:"",type:e.form.type?e.form.type.id:"",workarea:e.form.dutyArea?e.form.dutyArea.id:"",myarea:e.form.dutyDepartment?e.form.dutyDepartment.id:"",remark:e.form.remark,imgList:e.form.imageList}).then((function(e){c["a"].back()})).catch((function(t){e.$toast(t)}))}))):this.$toast.fail("请填写所有必填项,可填写无")},handleSelectExameDate:function(){this.dateShow=!0},handleDateConfirm:function(e){this.form.exameDate=m()(e).format("YYYY-MM-DD"),this.dateShow=!1},handleSelectDepartment:function(){this.departmentShow=!0,this.departmentRadio=v({},this.form.exameDepartment),this.departmentType=1},handleSelectDeviceCategory:function(){c["a"].open("deviceCategory",{profession:this.form.profession?this.form.profession.id:null})},handleSelectDepartment2:function(){this.departmentShow=!0,this.departmentRadio=v({},this.form.dutyDepartment),this.departmentType=2},onDepartmentSelect:function(){1==this.departmentType?this.form.exameDepartment=v({},this.departmentRadio):this.form.dutyDepartment=v({},this.departmentRadio),this.departmentShow=!1},handleSelectUser:function(){this.userShow=!0,this.userCheckbox=Object(i["a"])(this.form.exameUser)},onUserSelect:function(){this.form.exameUser=Object(i["a"])(this.userCheckbox),this.userShow=!1},handleSelectProfession:function(){this.professionShow=!0,this.professionRadio=v({},this.form.profession)},onProfessionSelect:function(){this.form.profession=v({},this.professionRadio),this.professionShow=!1},handleSelectType:function(){this.typeShow=!0,this.typeRadio=v({},this.form.troubleType)},onTypeSelect:function(){this.form.troubleType=v({},this.typeRadio),this.typeShow=!1},handleSelectLevel:function(){this.levelShow=!0,this.levelRadio=v({},this.form.troubleLevel)},onLevelSelect:function(){this.form.troubleLevel=v({},this.levelRadio),this.levelShow=!1},handleSelectArea:function(){this.areaShow=!0,this.areaRadio=v({},this.form.dutyArea)},onAreaSelect:function(){this.form.dutyArea=v({},this.areaRadio),this.areaShow=!1},handlePhoto1:function(){var e=this;api.getPicture({sourceType:"camera",destinationType:"url",preview:!0,quality:50,mediaValue:"pic"},(function(t,o){e.form.imageList.push({url:t.data})}))},handleImageRemove:function(e){this.form.imageList.splice(e,1)},handlePlayImages:function(e){localStorage.setItem("photos",JSON.stringify(this.form.imageList)),c["a"].open("photoViewer",{index:e})}},watch:{"form.exameDepartment":{deep:!1,handler:function(e){var t=this;e.id&&p["a"].searchOrganization({department:e.id}).then((function(e){t.form.exameUser=[],t.userOptions=e.users}))}},"form.dutyDepartment":function(e){var t=this;e.id&&p["a"].getTroubleDepartment({parent:e.id}).then((function(e){t.form.dutyArea=null,t.areaOptions=e}))}}},g=b,S=o("2877"),y=Object(S["a"])(g,a,r,!1,null,null,null),k=y.exports,w=o("a1db");w["a"].init(k)},8:function(e,t,o){e.exports=o("5ccf")}});
//# sourceMappingURL=createTrouble.f43eebea.js.map