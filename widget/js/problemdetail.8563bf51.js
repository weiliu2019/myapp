(function(t){function a(a){for(var i,s,o=a[0],r=a[1],c=a[2],u=0,v=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&v.push(n[s][0]),n[s]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);d&&d(a);while(v.length)v.shift()();return l.push.apply(l,c||[]),e()}function e(){for(var t,a=0;a<l.length;a++){for(var e=l[a],i=!0,o=1;o<e.length;o++){var r=e[o];0!==n[r]&&(i=!1)}i&&(l.splice(a--,1),t=s(s.s=e[0]))}return t}var i={},n={problemdetail:0},l=[];function s(a){if(i[a])return i[a].exports;var e=i[a]={i:a,l:!1,exports:{}};return t[a].call(e.exports,e,e.exports,s),e.l=!0,e.exports}s.m=t,s.c=i,s.d=function(t,a,e){s.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,a){if(1&a&&(t=s(t)),8&a)return t;if(4&a&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var i in t)s.d(e,i,function(a){return t[a]}.bind(null,i));return e},s.n=function(t){var a=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(a,"a",a),a},s.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],r=o.push.bind(o);o.push=a,o=o.slice();for(var c=0;c<o.length;c++)a(o[c]);var d=r;l.push([33,"chunk-vendors","chunk-common"]),e()})({"0ba9":function(t,a,e){"use strict";var i=e("d7a8"),n=e.n(i);n.a},33:function(t,a,e){t.exports=e("61f0")},"61f0":function(t,a,e){"use strict";e.r(a);e("cadf"),e("551c"),e("f751"),e("097d");var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("page",{ref:"page",staticClass:"problem-page common-page",attrs:{headerHeightVW:t.headerHeightVW,scrollbar:""},on:{"on-ready":t.onReady,"on-show":t.onShow}},[e("van-nav-bar",{attrs:{slot:"header",id:"header",title:"问题详情","left-arrow":""},on:{"click-left":t.onClickLeft},slot:"header"}),t.detail.id?e("detail",{attrs:{data:t.detail}}):t._e(),e("div",{staticClass:"blank-empty"}),t.showAction?e("template",{slot:"blank"},["wait_assigned"==t.detail.status&&"foreman"==t.user.job?e("div",{staticClass:"footer-action"},[e("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:t.handleAccept}},[t._v("受理")])],1):t._e(),"following_up"==t.detail.status&&t.detail.user&&t.detail.user.id==t.user.id&&t.detail.canReview?e("div",{staticClass:"footer-action"},[e("van-button",{staticClass:"action-item-main btn-save",attrs:{color:"rgba(16, 142, 233, 0.15)"},on:{click:t.handleForward}},[t._v("转发")]),e("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:t.handleFollow}},[t._v("跟进")])],1):t._e(),!t.detail.canReview||"pending_review"!=t.detail.status&&"pending_review1"!=t.detail.status&&"pending_review2"!=t.detail.status?t._e():e("div",{staticClass:"footer-action"},["wait_assigned"==t.detail.status&&"foreman"==t.user.job?e("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:t.handleAccept}},[t._v("受理")]):t._e(),e("van-button",{staticClass:"action-item-main btn-save",attrs:{color:"rgba(16, 142, 233, 0.15)"},on:{click:t.handleTurnDown}},[t._v("驳回")]),"pending_review"==t.detail.status||"pending_review1"==t.detail.status?e("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:t.handlePass}},[t._v("通过")]):t._e(),"pending_review2"==t.detail.status?e("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:t.handleClose}},[t._v("关闭问题")]):t._e()],1),e("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:t.turndownShow,callback:function(a){t.turndownShow=a},expression:"turndownShow"}},[e("div",{staticClass:"title"},[t._v("\n        填写驳回原因\n      ")]),e("van-field",{attrs:{placeholder:"请填写驳回原因",type:"textarea",rows:2,autosize:""},model:{value:t.turndownDesc,callback:function(a){t.turndownDesc=a},expression:"turndownDesc"}}),e("div",{staticClass:"footer-action"},[e("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:t.onTurndownConfirm}},[t._v("确定驳回")])],1)],1)],1):t._e()],2)},n=[],l=e("9973"),s=e("c03e"),o=e("365c"),r=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"detail-container"},[i("div",{staticClass:"detail-header"},[i("div",{staticClass:"detail-cell"},[i("div",{staticClass:"detail-no"},[t._v(t._s(t.data.no))]),i("div",{staticClass:"detail-status"},[t._v(t._s(t.problemStatusEnum[t.data.status]))])]),i("div",{staticClass:"detail-cell"},[i("div",{staticClass:"detail-time1"},[t._v("计划完成时间: "+t._s(t.data.finishTime))]),i("div",{staticClass:"detail-time2"},[t._v(t._s(t.data.consumeTime)+" min")])])]),i("van-cell-group",[i("van-cell",{staticClass:"detail-title",attrs:{title:"摘要："}}),i("van-cell",[i("span",{staticStyle:{color:"#969799"}},[t._v(t._s(t.data.summary||"无"))])]),i("van-cell",{attrs:{title:"发生时间："}},[t._v("\n      "+t._s(t.data.time)+"\n    ")]),i("van-cell",{attrs:{title:"发生地点："}},[t._v(t._s(t.data.line&&t.data.line.name+" "+t.data.station&&t.data.station.name+" "+t.data.address))]),i("van-cell",{attrs:{title:"故障设备分类："}},[t._v(t._s(t.data.deviceCategory.name))]),i("van-cell",{attrs:{title:"车组号："}},[t._v(t._s(t.data.carNo))]),i("van-cell",{attrs:{title:"所属专业："}},[t._v(t._s(t.data.profession&&t.data.profession.name))]),i("van-cell",{attrs:{title:"问题来源："}},[t._v(t._s(t.data.source&&t.data.source.name))]),i("van-cell",{attrs:{title:"问题等级："}},[t._v(t._s(t.data.level&&t.data.level.id?t.data.level.name:"无"))]),i("van-cell",{attrs:{title:"问题分类："}},[t._v(t._s(t.data.category&&t.data.category.id?t.data.category.name:"无"))]),i("van-cell",{attrs:{title:"承包商："}},[t._v(t._s(t.data.contractor&&t.data.contractor.id?t.data.contractor.name:"无"))]),i("van-cell",{attrs:{title:"通知承包商时间："}},[t._v(t._s(t.data.contractorNoticeTime))]),i("van-cell",{attrs:{title:"承包商答复时间："}},[t._v(t._s(t.data.contractorReplyTime))]),i("van-cell",{attrs:{title:"承包商开始工作时间："}},[t._v(t._s(t.data.contractorBeginTime))]),i("van-cell",{attrs:{title:"承包商完成工作时间："}},[t._v(t._s(t.data.contractorFinishTime))]),i("van-cell",{attrs:{title:"非维修时间："}},[t._v(t._s(t.data.noRepairTime))]),i("van-cell",{attrs:{title:"故障修复时间："}},[t._v(t._s(t.data.repairFinishTime))]),i("van-cell",{attrs:{title:"当前处理人："}},[t._v(t._s(t.data.user&&t.data.user.id?t.data.user.name:"无"))]),i("van-cell",{staticClass:"detail-title",attrs:{title:"问题简述："}}),i("van-cell",[i("span",{staticStyle:{color:"#969799"}},[t._v(t._s(t.data.problemDesc||"无"))])]),i("van-cell",{staticClass:"detail-title",attrs:{title:"问题描述："}}),i("van-cell",[i("span",{staticStyle:{color:"#969799"}},[t._v(t._s(t.data.description||"无"))])]),i("van-cell",{staticClass:"detail-title",attrs:{title:"原因分析："}}),i("van-cell",[i("span",{staticStyle:{color:"#969799"}},[t._v(t._s(t.data.analysis||"无"))])]),i("van-cell",{attrs:{title:"初步解决方案："}},[t._v(t._s(t.data.beginSolutions||"无"))]),i("van-cell",{attrs:{title:"最终解决方案："}},[t._v(t._s(t.data.finishSolutions||"无"))])],1),i("van-cell-group",[i("van-cell",{staticClass:"detail-title",attrs:{title:"图像："}}),i("div",{staticClass:"images-container"},t._l(t.data.images,(function(a,e){return i("div",{key:e,staticClass:"image-item-show",on:{click:function(a){return t.handlePlayImages(e)}}},[i("auto-image",{staticStyle:{"margin-bottom":"12px","margin-left":"12px"},attrs:{src:a.url,width:108,height:108}})],1)})),0)],1),i("van-cell-group",[i("van-cell",{staticClass:"detail-title",attrs:{title:"视频："}}),i("div",{staticClass:"images-container"},t._l(t.data.videos,(function(a,n){return i("div",{key:n,staticClass:"image-item-show",on:{click:function(e){return t.handlePlayVideo(a)}}},[i("img",{staticClass:"img-video",attrs:{src:e("f0f8")}})])})),0)],1),i("van-cell-group",[i("van-cell",{staticClass:"detail-title",attrs:{title:"附件："}}),i("div",{staticClass:"images-container"},t._l(t.data.annex,(function(a,n){return i("div",{key:n,staticClass:"image-item-show",on:{click:function(e){return t.handlePlayAnnex(a)}}},[i("img",{staticClass:"img-video",attrs:{src:e("2e6e")}})])})),0)],1),t.data.faultId?i("van-cell-group",[i("van-cell",{attrs:{title:"故障信息","is-link":"",clickable:""},on:{click:t.handleFaultDetail}})],1):t._e(),i("van-cell-group",[i("van-cell",{attrs:{title:"处理记录","is-link":"",clickable:""},on:{click:t.handleRecord}})],1)],1)},c=[],d=e("08f3"),u=e("4ff5"),v={props:["data"],components:{AutoImage:u["a"]},data:function(){return{problemStatusEnum:d["d"]}},methods:{handleRecord:function(){s["a"].open("problemRecord",{id:this.data.id})},handleFaultDetail:function(){s["a"].open("faultdetail",{id:this.data.faultId})},handlePlayImages:function(t){localStorage.setItem("photos",JSON.stringify(this.data.images)),s["a"].open("photoViewer",{index:t})},handlePlayVideo:function(t){api.openVideo({url:t.url})},handlePlayAnnex:function(t){s["a"].open("browser",{url:t.url})}}},f=v,h=(e("cdab3"),e("2877")),p=Object(h["a"])(f,r,c,!1,null,null,null),m=p.exports,_={components:{Page:l["a"],Detail:m},data:function(){return{headerHeightVW:0,id:null,detail:{},user:JSON.parse(localStorage.getItem("user")),turndownDesc:"",turndownShow:!1,showAction:!1}},methods:{onReady:function(t,a){this.headerHeightVW=100*(t.h+1)/t.w,this.id=s["a"].getParam("id"),this.loadDetail()},onShow:function(){if(localStorage.getItem("redirect")){var t=localStorage.getItem("redirect");localStorage.setItem("redirect",""),s["a"].open(t,{id:this.id}),this.loadDetail()}else this.loadDetail()},loadDetail:function(){var t=this;this.$toast.loading({duration:0,loadingType:"spinner"}),o["a"].getProblemDetail({id:this.id}).then((function(a){t.detail=a,t.$toast.clear(),t.showAction=!0})).catch((function(a){t.$toast(a)}))},onClickLeft:function(){s["a"].back()},handleAccept:function(){var t=this;this.$dialog.confirm({message:"是否确认受理问题？",beforeClose:function(a,e){var i=this;"confirm"===a?(console.log(t.id),o["a"].acceptProblem({id:t.id}).then((function(){e(),t.loadDetail()})).catch((function(t){i.$toast(t),e()}))):e()}})},handleForward:function(){s["a"].open("organization",{id:this.id,mode:"problem",job:"foreman",profession:this.detail.professionId,status:this.detail.status})},handleFollow:function(){s["a"].open("follow",{id:this.id})},onTurndownConfirm:function(){var t=this;this.$toast.loading({duration:0,loadingType:"spinner"}),this.turndownShow=!1,o["a"].turndownProblem({id:this.id,content:this.turndownDesc}).then((function(){t.loadDetail(),t.$toast.clear()})).catch((function(a){t.$toast(a)}))},handleTurnDown:function(){this.turndownShow=!0},handlePass:function(){"pending_review"==this.detail.status&&s["a"].open("circulation",{id:this.id,flow:JSON.stringify(this.flow),profession:this.detail.professionId,job:"engineer_duty",status:this.detail.status}),"pending_review1"==this.detail.status&&s["a"].open("circulation",{id:this.id,flow:JSON.stringify(this.flow),profession:this.detail.professionId,job:"senior_engineer_business",status:this.detail.status})},handleClose:function(){var t=this;this.$dialog.confirm({message:"是否确认关闭问题？",beforeClose:function(a,e){var i=this;"confirm"===a?(console.log(t.id),o["a"].closeProblem({id:t.id}).then((function(){e(),t.loadDetail()})).catch((function(t){i.$toast(t),e()}))):e()}})}}},g=_,b=(e("0ba9"),Object(h["a"])(g,i,n,!1,null,null,null)),w=b.exports,y=e("a1db");y["a"].init(w)},"7fa6":function(t,a,e){},cdab3:function(t,a,e){"use strict";var i=e("7fa6"),n=e.n(i);n.a},d7a8:function(t,a,e){}});
//# sourceMappingURL=problemdetail.8563bf51.js.map