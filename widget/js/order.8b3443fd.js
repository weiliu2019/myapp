(function(e){function t(t){for(var n,r,o=t[0],l=t[1],c=t[2],p=0,f=[];p<o.length;p++)r=o[p],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&f.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(f.length)f.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],n=!0,o=1;o<i.length;o++){var l=i[o];0!==a[l]&&(n=!1)}n&&(s.splice(t--,1),e=r(r.s=i[0]))}return e}var n={},a={order:0},s=[];function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;s.push([23,"chunk-vendors","chunk-common"]),i()})({"0a81":function(e,t,i){},"105a":function(e,t,i){},23:function(e,t,i){e.exports=i("98a1")},3554:function(e,t,i){"use strict";var n=i("105a"),a=i.n(n);a.a},9098:function(e,t,i){"use strict";var n=i("0a81"),a=i.n(n);a.a},"98a1":function(e,t,i){"use strict";i.r(t);i("cadf"),i("551c"),i("f751"),i("097d");var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page",{ref:"page",staticClass:"order-page create-action-page",attrs:{headerHeightVW:e.headerHeightVW,scrollbar:"",pullDownRefresh:!0,pullUpLoad:!0},on:{"on-ready":e.onReady,"on-refresh":e.onRefresh,"on-show":e.onShow,"on-load":e.onLoad}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("van-nav-bar",{attrs:{id:"header",title:"智能维修"}},[i("i",{staticClass:"icon-wode nav-icon-right",attrs:{slot:"right"},on:{click:e.handleToMe},slot:"right"})]),i("van-popup",{staticClass:"header-more",style:{top:e.moreTop+"vw"},model:{value:e.moreAction,callback:function(t){e.moreAction=t},expression:"moreAction"}},[i("div",{staticClass:"more-action"},[i("van-cell",{attrs:{title:"提报故障",clickable:""},nativeOn:{click:function(t){return e.handleCreateFault(t)}}}),i("van-cell",{attrs:{title:"提报问题",clickable:""},nativeOn:{click:function(t){return e.handleCreateProblem(t)}}})],1)]),i("div",{staticClass:"order-tabs"},[i("van-tabs",{model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[i("van-tab",[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("全部")])]),i("van-tab",[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("\n            待接报\n            "),e.receiveNum?i("i",{staticClass:"order-tab-tag"},[e._v(e._s(e.receiveNum))]):e._e()])]),i("van-tab",[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("\n            执行中\n            "),e.executingNum?i("i",{staticClass:"order-tab-tag"},[e._v(e._s(e.executingNum))]):e._e()])]),i("van-tab",[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("\n            待审核\n            "),e.reviewNum?i("i",{staticClass:"order-tab-tag"},[e._v(e._s(e.reviewNum))]):e._e()])]),i("van-tab",[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("\n            已挂起\n            "),e.suspendedNum?i("i",{staticClass:"order-tab-tag"},[e._v(e._s(e.suspendedNum))]):e._e()])]),i("van-tab",[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("已关闭")])])],1)],1),i("div",{staticClass:"search-bar"},[i("van-search",{attrs:{placeholder:"请输入搜索工单编号"},model:{value:e.filter.key,callback:function(t){e.$set(e.filter,"key",t)},expression:"filter.key"}}),i("div",{staticClass:"search-action"},[i("i",{staticClass:"search-scan search-icon",on:{click:e.handleScan}}),0==e.tabActive?i("i",{staticClass:"search-filter search-icon",on:{click:e.handleFilter}}):e._e()])],1)],1),e.loading?i("van-loading",{staticClass:"page-loading",attrs:{type:"spinner"}}):e._e(),e.orderList.length?e._e():i("div",{staticStyle:{"text-align":"center","line-height":"100px"}},[e._v("暂无数据")]),i("transition-group",{staticClass:"order-list",attrs:{tag:"div",name:"list"}},e._l(e.orderList,(function(t){return e.orderList.length?i("item",{key:t.id,attrs:{data:t},nativeOn:{click:function(i){return e.handleDetail(t)}}}):e._e()})),1),i("template",{slot:"bar"},[i("van-popup",{staticClass:"order-filter-popup",attrs:{position:"right","lock-scroll":!1},model:{value:e.filterShow,callback:function(t){e.filterShow=t},expression:"filterShow"}},[e.filterShow?i("a-scroll",{ref:"filterScroller",staticClass:"order-filter-scroll",attrs:{scrollbar:""}},[i("div",{staticClass:"order-filter-content"},[i("van-cell-group",{attrs:{title:"工单类型",border:!1}},[i("van-row",{staticClass:"filter-options",attrs:{gutter:"10"}},[i("van-col",{attrs:{span:"8"}},[i("div",{staticClass:"filter-options-item",class:{"is-active":e.tempFilter.type.indexOf("1")>=0},on:{click:function(t){return e.handleToggleType("1")}}},[e._v("故障修")])]),i("van-col",{attrs:{span:"8"}},[i("div",{staticClass:"filter-options-item",class:{"is-active":e.tempFilter.type.indexOf("2")>=0},on:{click:function(t){return e.handleToggleType("2")}}},[e._v("计划修")])])],1)],1),i("van-cell-group",{attrs:{title:"线别站点",border:!1}},[i("van-button",{staticClass:"xbzd",attrs:{type:"default"},on:{click:e.handleSelectLine}},[e._v("\n              "+e._s(e.tempFilter.lineObject&&e.tempFilter.lineObject.name)+" / "+e._s(e.tempFilter.stationObject&&e.tempFilter.stationObject.name)+"\n            ")])],1),i("van-cell-group",{attrs:{title:"所属专业",border:!1}},[i("van-row",{staticClass:"filter-options",attrs:{gutter:"10"}},[i("van-col",{attrs:{span:"8"}},[i("div",{staticClass:"filter-options-item",class:{"is-active":""==e.tempFilter.profession},on:{click:function(t){return e.handleToggleProfession("")}}},[e._v("全部")])]),e._l(e.professionOptions,(function(t){return i("van-col",{key:t.id,attrs:{span:"8"}},[i("div",{staticClass:"filter-options-item",class:{"is-active":e.tempFilter.profession==t.id},on:{click:function(i){return e.handleToggleProfession(t.id)}}},[e._v(e._s(t.name))])])}))],2)],1),i("van-cell-group",{attrs:{title:"故障等级",border:!1}},[i("van-row",{staticClass:"filter-options",attrs:{gutter:"10"}},[i("van-col",{attrs:{span:"8"}},[i("div",{staticClass:"filter-options-item",class:{"is-active":""==e.tempFilter.level},on:{click:function(t){return e.handleToggleLevel("")}}},[e._v("全部")])]),e._l(e.levelOptions.filter((function(t){return t.profession.includes(e.tempFilter.profession)})),(function(t){return i("van-col",{key:t.id,attrs:{span:"8"}},[i("div",{staticClass:"filter-options-item",class:{"is-active":e.tempFilter.level==t.id},on:{click:function(i){return e.handleToggleLevel(t.id)}}},[e._v(e._s(t.name))])])}))],2)],1),i("van-cell-group",{attrs:{title:"时间",border:!1}},[i("van-dropdown-menu",{staticClass:"select-bar"},[i("van-dropdown-item",{ref:"beginTime",attrs:{title:e.tempFilter.beginTime},on:{open:e.handleBeginTimeClick}}),i("van-dropdown-item",{ref:"endTime",attrs:{title:e.tempFilter.endTime},on:{open:e.handleEndTimeClick}})],1)],1)],1)]):e._e(),i("div",{staticClass:"order-filter-action"},[i("van-button",{attrs:{color:"#108EE9"},nativeOn:{click:function(t){return e.handleConfirmFilter(t)}}},[e._v("确定")])],1)],1)],1),i("template",{slot:"blank"},[i("div",{staticClass:"fault-action",on:{click:e.handleCreateFault}}),i("div",{staticClass:"problem-action",on:{click:e.handleCreateProblem}}),i("van-dialog",{attrs:{title:"开始时间","show-cancel-button":""},on:{confirm:e.handleBeginTimeConfirm},model:{value:e.beginTimeShow,callback:function(t){e.beginTimeShow=t},expression:"beginTimeShow"}},[i("van-datetime-picker",{attrs:{type:"date","show-toolbar":!1},model:{value:e.beginTime,callback:function(t){e.beginTime=t},expression:"beginTime"}})],1),i("van-dialog",{attrs:{title:"结束时间","show-cancel-button":""},on:{confirm:e.handleEndTimeConfirm},model:{value:e.endTimeShow,callback:function(t){e.endTimeShow=t},expression:"endTimeShow"}},[i("van-datetime-picker",{attrs:{type:"date","show-toolbar":!1},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1)],1)],2)},a=[],s=(i("1c01"),i("58b2"),i("8e6e"),i("f3e2"),i("ac6a"),i("456d"),i("28a5"),i("bd86")),r=(i("57e7"),i("6762"),i("2fdb"),i("d25f"),i("20d6"),i("9973")),o=i("4e1b"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"order-item"},[i("div",{staticClass:"item-header"},[i("div",{staticClass:"left"},[i("span",[e._v(e._s(e.data.no))]),i("span",{staticClass:"item-type item-guzhang",class:{"item-weixiu":2==e.data.type}},[e._v(e._s(1==e.data.type?"故障":"维修"))])]),i("div",{staticClass:"right"},[i("span",{staticClass:"item-status",class:{"item-weixiu":2==e.data.type}},[e._v(e._s(e.statusEnum[e.data.state?e.data.state:e.data.status]))])])]),i("div",{staticClass:"item-content"},[e.data.profession||e.data.level?i("span",{staticClass:"item-level"},[e._v("【"+e._s(e.data.profession)+e._s(e.data.profession&&e.data.level?" - ":"")+e._s("object"==typeof e.data.level?e.data.level.name:e.data.level)+"】")]):e._e(),i("span",[e._v(e._s(e.data.planDesc?e.data.planDesc:e.data.content))]),2==e.data.type?i("span",[e._v("\n      【"+e._s(e.data.planType)+"】"+e._s(e.data.planTableName)+" - "+e._s(e.data.planTableNo)+"\n    ")]):e._e()]),i("div",{staticClass:"item-cell"},[i("div",{staticClass:"item-address"},[e._v(e._s(e.data.station))])]),i("div",{staticClass:"item-cell"},[i("div",{staticClass:"item-time1"},[1==e.data.type?i("span",[e._v("通报时间:"+e._s(e.data.createTime))]):i("span",[e._v("完成截止时间:"+e._s(e.data.planFinishTime))])]),1==e.data.type?i("div",{staticClass:"item-time2"},[e._v(e._s(e.data.timeConsuming)+" min")]):e._e()])])},c=[],d=i("08f3"),p={props:["data"],data:function(){return{statusEnum:d["e"],planStatusEnum:d["c"]}}},f=p,u=(i("9098"),i("2877")),h=Object(u["a"])(f,l,c,!1,null,null,null),m=h.exports,v=i("c03e"),g=i("365c"),b=i("8149"),_=i("698a"),O=i("c1df"),y=i.n(O);function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function w(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){Object(s["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var T={components:{Page:r["a"],Item:m,AScroll:o["a"]},data:function(){return{headerHeightVW:17.6,moreAction:!1,moreTop:0,header:null,filterLine:null,filterStation:null,filter:{key:"",line:"",station:"",lineObject:null,stationObject:null,beginTime:"",endTime:"",pageIndex:1,pageSize:5,type:"1,2",status:"assigned,pending_sign,waiting_repair,pending_submission,pending_item_review,pending_review,close,sold_item,hang",profession:"",level:""},tempFilter:{},filterShow:!1,tabActive:0,receiveNum:0,executingNum:0,reviewNum:0,suspendedNum:0,statusEnum:d["e"],addressOptions:[],columns:[],orderList:[],loading:!0,allList:[],reasonOptions:[],typeOptions:[],levelOptions:JSON.parse(localStorage.getItem("level_options")),localList:[],professionOptions:JSON.parse(localStorage.getItem("profession_options")),beginTimeShow:!1,beginTime:new Date,endTimeShow:!1,endTime:new Date,FNScanner:null}},methods:{onReady:function(e,t){var i=this;this.header=e,console.log(JSON.stringify(e)),console.log(JSON.stringify(t)),this.headerHeightVW=100*(this.header.h+100)/this.header.w,this.moreTop=100*this.header.h/this.header.w,this.loadStatistics(),setInterval((function(){i.loadStatistics()}),5e3),b["a"].getOrderIds().then((function(e){i.localList=e,i.syncLocalOrder()})),this.onRefresh()},onMoreAction:function(){this.moreAction=!0},onShow:function(){var e=this;if(this.loadStatistics(),localStorage.getItem("refresh_order_id")&&2!=this.tabActive&&g["a"].getOrderListId({id:localStorage.getItem("refresh_order_id")}).then((function(t){var i=e.orderList.findIndex((function(e){return e.id==t.detail.id}));i>=0&&e.$set(e.orderList,i,t.detail),localStorage.setItem("refresh_order_id","")})).catch((function(){localStorage.setItem("refresh_order_id","")})),localStorage.getItem("address_select")){var t=JSON.parse(localStorage.getItem("address_select"));this.tempFilter.lineObject=t[0],this.tempFilter.line=t[0].id,this.tempFilter.stationObject=t[t.length-1],this.tempFilter.station=this.tempFilter.stationObject.id,localStorage.setItem("address_select","")}this.syncLocalOrder()},onRefresh:function(){var e=this;this.filter.pageIndex=1,2==this.tabActive?b["a"].getOrderList(this.filter).then((function(t){e.orderList=t,e.filter.pageIndex++,e.$refs.page.finishRefresh(),e.$refs.page.updateLoad(),e.loading=!1})):g["a"].getOrderList(this.filter).then((function(t){e.orderList=t.list,e.filter.pageIndex++,e.$refs.page.finishRefresh(),e.loading=!1,e.syncLocalOrder()})).catch((function(t){e.$toast(t),e.$refs.page.finishRefresh(),e.loading=!1}))},syncLocalOrder:function(){var e=this;_["a"].connection()&&g["a"].getOrderSyncIds().then((function(t){for(var i=0;i<t.ids.length;i++){var n=t.ids[i];e.localList.includes(n)||(n.indexOf("maintenance_order")>=0?g["a"].getPlanDetail({id:n}).then((function(e){b["a"].saveOrder(w({},e,{type:2}))})):g["a"].getOrderDetail({id:n}).then((function(e){b["a"].saveOrder(w({},e,{type:1}))})))}for(var a=0;a<e.localList.length;a++){var s=e.localList[a];t.ids.includes(s)||b["a"].removeOrder(s).then((function(){}))}}))},onLoad:function(){var e=this;2==this.tabActive?b["a"].getOrderList(this.filter).then((function(t){e.orderList=e.orderList.concat(t),e.filter.pageIndex++,0==data.list.length?e.$refs.page.endLoad():e.$refs.page.updateLoad(),e.loading=!1})):g["a"].getOrderList(this.filter).then((function(t){e.orderList=e.orderList.concat(t.list),e.filter.pageIndex++,0==t.list.length?e.$refs.page.endLoad():e.$refs.page.updateLoad(),e.loading=!1,e.syncLocalOrder()})).catch((function(t){e.$toast(t),e.$refs.page.updateLoad(),e.loading=!1}))},handleFilter:function(){this.tempFilter=w({},this.filter),this.filterShow=!0},handleScan:function(){this.FNScanner||(this.FNScanner=api.require("FNScanner")),this.FNScanner.open({autorotation:!0})},handleConfirmFilter:function(){this.filterShow=!1,this.filter=w({},this.filter,{},this.tempFilter),this.onRefresh()},handleDetail:function(e){localStorage.setItem("refresh_order_id",e.id),1==e.type?v["a"].open("orderdetail",{id:e.id}):v["a"].open("plan_detail",{id:e.id})},loadStatistics:function(){var e=this;g["a"].getOrderStatistics().then((function(t){console.log(t),e.receiveNum=t.receive,e.reviewNum=t.review,e.suspendedNum=t.suspended})),b["a"].getOrderCount().then((function(t){e.executingNum=t}))},loadOrderConfig:function(){var e=this;g["a"].getOrderConfig().then((function(t){e.addressOptions=t.address,localStorage.setItem("level_options",JSON.stringify(t.level)),localStorage.setItem("reason_options",JSON.stringify(t.reason)),localStorage.setItem("type_options",JSON.stringify(t.type)),localStorage.setItem("line_options",JSON.stringify(t.address)),localStorage.setItem("profession_options",JSON.stringify(t.profession)),localStorage.setItem("source_options",JSON.stringify(t.source))}))},handleToggleType:function(e){var t=this.tempFilter.type.split(",");this.tempFilter.type.indexOf(e)>=0?t.splice(t.findIndex((function(t){return t==e})),1):t.push(e),this.tempFilter.type=t.join(",")},handleToggleProfession:function(e){this.tempFilter.profession!=e&&(this.tempFilter.level=""),this.tempFilter.profession=e},handleToggleLevel:function(e){this.tempFilter.level=e},handleToggleStatus:function(e){var t=this.tempFilter.status.split(",");this.tempFilter.status.indexOf(e)>=0?t.splice(t.findIndex((function(t){return t==e})),1):t.push(e),this.tempFilter.status=t.join(",")},handleCreateFault:function(){this.moreAction=!1,v["a"].open("createFault")},handleCreateProblem:function(){this.moreAction=!1,v["a"].open("createProblem")},handleSelectLine:function(){v["a"].open("address")},handleBeginTimeClick:function(){this.beginTime=new Date(this.tempFilter.beginTime),this.beginTimeShow=!0},handleBeginTimeConfirm:function(e){console.log(this.beginTime),this.tempFilter.beginTime=y()(this.beginTime).format("YYYY-MM-DD"),this.beginTimeShow=!1},handleEndTimeClick:function(){this.endTime=new Date(this.tempFilter.endTime),this.endTimeShow=!0},handleEndTimeConfirm:function(e){console.log(this.endTime),this.tempFilter.endTime=y()(this.endTime).format("YYYY-MM-DD"),this.endTimeShow=!1},handleToMe:function(){v["a"].open("me")}},watch:{tabActive:function(e){var t=this;this.loading=!0,0==e&&(this.filter.status="assigned,pending_sign,waiting_repair,pending_submission,pending_item_review,pending_review,close,sold_item,hang",this.filter.pageIndex=1),1==e&&(this.filter.status="assigned",this.filter.pageIndex=1),3==e&&(this.filter.status="pending_item_review,pending_review",this.filter.pageIndex=1),4==e&&(this.filter.status="hang",this.filter.pageIndex=1),5==e&&(this.filter.status="close,sold_item",this.filter.pageIndex=1),this.$nextTick((function(){t.onRefresh()}))},"filter.key":function(e){this.onRefresh()}}},C=T,F=(i("3554"),Object(u["a"])(C,n,a,!1,null,null,null)),k=F.exports,x=i("a1db");x["a"].init(k)}});
//# sourceMappingURL=order.8b3443fd.js.map