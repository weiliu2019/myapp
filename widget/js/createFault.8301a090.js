(function(e){function t(t){for(var o,a,l=t[0],c=t[1],r=t[2],u=0,p=[];u<l.length;u++)a=l[u],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&p.push(s[a][0]),s[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);d&&d(t);while(p.length)p.shift()();return n.push.apply(n,r||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],o=!0,l=1;l<i.length;l++){var c=i[l];0!==s[c]&&(o=!1)}o&&(n.splice(t--,1),e=a(a.s=i[0]))}return e}var o={},s={createFault:0},n=[];function a(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=o,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(i,o,function(t){return e[t]}.bind(null,o));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var r=0;r<l.length;r++)t(l[r]);var d=c;n.push([6,"chunk-vendors","chunk-common"]),i()})({"09c7":function(e,t,i){"use strict";i.r(t);i("cadf"),i("551c"),i("f751"),i("097d");var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("page",{ref:"page",staticClass:"create-page common-page",attrs:{headerHeightVW:e.headerHeightVW,scrollbar:""},on:{"on-ready":e.onReady,"on-show":e.onShow}},[o("van-nav-bar",{attrs:{slot:"header",id:"header",title:"故障提报","left-arrow":""},on:{"click-left":e.onClickLeft},slot:"header"}),o("van-cell-group",[o("van-cell",{attrs:{required:"",title:"所属专业","is-link":"",clickable:""},on:{click:e.handleSelectProfession}},[o("span",[e._v(e._s(e.profession&&e.profession.name))])]),o("van-cell",{attrs:{title:"发生时间","is-link":"",clickable:""},on:{click:e.handleSelectTime}},[o("span",[e._v(e._s(e.time))])])],1),o("van-cell-group",[o("van-cell",{attrs:{required:"",title:"故障地点","is-link":"",clickable:""},on:{click:e.handleSelectLine}},[o("span",[e._v(e._s(e.line&&e.line.name)+" / "+e._s(e.station&&e.station.name))])]),o("van-field",{attrs:{placeholder:"请输入详细地址",type:"textarea",rows:2,autosize:""},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}}),o("van-cell",{attrs:{required:"",title:"故障设备","is-link":"",clickable:""},on:{click:e.handleSelectDevice}},[e._v(e._s(e.deviceType&&e.deviceType.name)+" / "+e._s(e.device&&e.device.name))])],1),o("van-cell-group",[o("van-cell",{attrs:{title:"故障分类","is-link":"",clickable:""},on:{click:e.handleSelectReason}},[o("span",[e._v(e._s(e.reason&&e.reason.name))])]),o("van-cell",{attrs:{title:"故障等级","is-link":"",clickable:""},on:{click:e.handleSelectLevel}},[o("span",[e._v(e._s(e.level&&e.level.name))])]),o("van-cell",{attrs:{title:"故障来源","is-link":"",clickable:""},on:{click:e.handleSelectSource}},[o("span",[e._v(e._s(e.source&&e.source.name))])])],1),o("van-cell-group",[o("van-cell",{staticClass:"detail-title",attrs:{required:"",title:"故障现象："}}),o("van-field",{attrs:{placeholder:"请输入现象",type:"textarea",rows:2,autosize:""},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1),o("van-cell-group",[o("van-cell",{staticClass:"detail-title",attrs:{title:"图像："}}),o("div",{staticClass:"images-container"},[e._l(e.imageList,(function(t,i){return o("div",{key:i,staticClass:"image-item-show",on:{click:function(t){return e.handlePlayImages(i)}}},[o("auto-image",{staticStyle:{"margin-bottom":"12px","margin-left":"12px"},attrs:{src:t.url,width:108,height:108}}),o("div",{staticClass:"image-remove",on:{click:function(t){return t.stopPropagation(),e.handleImageRemove(i)}}})],1)})),o("div",{staticClass:"image-item",staticStyle:{background:"#fff"},on:{click:function(t){return t.stopPropagation(),e.handlePhoto1(t)}}},[o("img",{attrs:{src:i("4857")}})])],2)],1),o("van-cell-group",[o("van-cell",{staticClass:"detail-title",attrs:{title:"视频："}}),o("div",{staticClass:"images-container"},[e._l(e.videoList,(function(t,s){return o("div",{key:s,staticClass:"image-item-show",on:{click:function(i){return e.handlePlayVideo(t)}}},[o("img",{staticClass:"img-video",attrs:{src:i("f0f8")}}),o("div",{staticClass:"image-remove",on:{click:function(t){return t.stopPropagation(),e.handleVideoRemove(s)}}})])})),o("div",{staticClass:"image-item",staticStyle:{background:"#fff"},on:{click:function(t){return t.stopPropagation(),e.handlePhoto2(t)}}},[o("img",{attrs:{src:i("4857")}})])],2)],1),o("div",{staticClass:"blank-empty"}),o("template",{slot:"blank"},[o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",on:{click:e.handleSave}},[e._v("保存")]),o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.handleSubmit}},[e._v("提交")])],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.professionShow,callback:function(t){e.professionShow=t},expression:"professionShow"}},[o("div",{staticClass:"title"},[e._v("选择所属专业")]),e.professionShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.professionRadio.id,callback:function(t){e.$set(e.professionRadio,"id",t)},expression:"professionRadio.id"}},[o("van-cell-group",e._l(e.professionOptions,(function(t){return o("van-cell",{key:t.id,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.professionRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onProfessionSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.sourceShow,callback:function(t){e.sourceShow=t},expression:"sourceShow"}},[o("div",{staticClass:"title"},[e._v("选择故障来源")]),e.sourceShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.sourceRadio.id,callback:function(t){e.$set(e.sourceRadio,"id",t)},expression:"sourceRadio.id"}},[o("van-cell-group",e._l(e.sourceOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.sourceRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onSourceSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.reasonShow,callback:function(t){e.reasonShow=t},expression:"reasonShow"}},[o("div",{staticClass:"title"},[e._v("选择故障分类")]),e.reasonShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.reasonRadio.id,callback:function(t){e.$set(e.reasonRadio,"id",t)},expression:"reasonRadio.id"}},[o("van-cell-group",e._l(e.reasonOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.reasonRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onReasonSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.typeShow,callback:function(t){e.typeShow=t},expression:"typeShow"}},[o("div",{staticClass:"title"},[e._v("选择故障类型")]),e.typeShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.typeRadio.id,callback:function(t){e.$set(e.typeRadio,"id",t)},expression:"typeRadio.id"}},[o("van-cell-group",e._l(e.typeOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.typeRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onTypeSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"filter-popup",attrs:{position:"bottom","lock-scroll":!1,closeable:"","close-icon":"close",round:""},model:{value:e.levelShow,callback:function(t){e.levelShow=t},expression:"levelShow"}},[o("div",{staticClass:"title"},[e._v("选择故障等级")]),e.levelShow?o("a-scroll",{ref:"filterScroller",staticClass:"filter-scroll"},[o("van-radio-group",{model:{value:e.levelRadio.id,callback:function(t){e.$set(e.levelRadio,"id",t)},expression:"levelRadio.id"}},[o("van-cell-group",e._l(e.levelOptions,(function(t,i){return o("van-cell",{key:i,attrs:{title:t.name,label:t.description,clickable:""},on:{click:function(i){e.levelRadio=Object.assign({},t)}}},[o("van-radio",{attrs:{slot:"right-icon",name:t.id},on:{click:function(i){e.levelRadio=t}},slot:"right-icon"})],1)})),1)],1)],1):e._e(),o("div",{staticClass:"footer-action"},[o("van-button",{staticClass:"action-item-main",attrs:{color:"#108EE9"},on:{click:e.onLevelSelect}},[e._v("确定")])],1)],1),o("van-popup",{staticClass:"time-popup",attrs:{position:"bottom","lock-scroll":!1,round:""},model:{value:e.timeShow,callback:function(t){e.timeShow=t},expression:"timeShow"}},[o("van-datetime-picker",{attrs:{type:"datetime",formatter:e.formatter},on:{confirm:e.handleConfirm,cancel:function(t){e.timeShow=!1}},model:{value:e.currentTime,callback:function(t){e.currentTime=t},expression:"currentTime"}})],1),o("van-dialog",{attrs:{"show-cancel-button":"","before-close":e.beforeClose},model:{value:e.editShow,callback:function(t){e.editShow=t},expression:"editShow"}},[o("van-cell",{attrs:{title:"描述"}}),o("van-field",{ref:"desInput",attrs:{type:"textarea",clearable:!0},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1)],1)],2)},s=[],n=(i("1c01"),i("58b2"),i("8e6e"),i("f3e2"),i("ac6a"),i("456d"),i("20d6"),i("d25f"),i("bd86")),a=i("9973"),l=i("4e1b"),c=i("c03e"),r=i("4ff5"),d=i("8149"),u=i("365c"),p=i("c1df"),h=i.n(p),f=i("698a"),v=i("0e5c");function m(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function g(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?m(Object(i),!0).forEach((function(t){Object(n["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var y={components:{Page:a["a"],AScroll:l["a"],AutoImage:r["a"]},data:function(){var e;return e={headerHeightVW:0,levelOptions:JSON.parse(localStorage.getItem("level_options")),reasonOptions:JSON.parse(localStorage.getItem("reason_options")),typeOptions:JSON.parse(localStorage.getItem("type_options")),professionOptions:JSON.parse(localStorage.getItem("profession_options")),sourceOptions:JSON.parse(localStorage.getItem("source_options")),profession:null,source:null,level:null,device:null,type:null,reason:null,reasonShow:!1,reasonRadio:null,sourceShow:!1,sourceRadio:null,typeShow:!1,typeRadio:null,levelShow:!1,levelRadio:null,professionShow:!1,professionRadio:null,imageList:[],videoList:[],UIPhotoViewer:null,editShow:!1,description:"",imgFile:"",repairContent:"",repairRemark:"",currentTime:new Date,timeShow:!1,time:h()().format("YYYY-MM-DD HH:mm"),line:null,station:null,lineShow:!1,lineColumns:[],address:"",content:""},Object(n["a"])(e,"device",null),Object(n["a"])(e,"deviceType",null),Object(n["a"])(e,"localId",null),Object(n["a"])(e,"imageFilter",null),Object(n["a"])(e,"videoCompression",null),e},methods:{onReady:function(e,t){var i=this;this.header=e,this.headerHeightVW=100*(this.header.h+1)/this.header.w,localStorage.setItem("device_select",""),localStorage.setItem("device_type_select",""),localStorage.setItem("address_select","");var o=c["a"].getParam("detail");o&&d["a"].getFaultDetail(o).then((function(e){i.profession=e.profession,i.time=e.time,i.line=e.line,i.station=e.station,i.address=e.address,i.reason=e.reason,i.type=e.type,i.level=e.level,i.source=e.source,i.content=e.content,i.imageList=e.images,i.videoList=e.videos,i.device=e.deviceId,i.deviceType=e.deviceCategory,i.localId=e.id}))},onShow:function(){if(localStorage.getItem("device_select")&&(this.device=JSON.parse(localStorage.getItem("device_select")),localStorage.setItem("device_select","")),localStorage.getItem("device_type_select")&&(this.deviceType=JSON.parse(localStorage.getItem("device_type_select")),localStorage.setItem("device_type_select","")),localStorage.getItem("address_select")){var e=JSON.parse(localStorage.getItem("address_select"));this.line=e[0],this.station=e[e.length-1]}},onClickLeft:function(){this.$dialog.confirm({message:"返回数据将丢失，是否确认返回？",confirmButtonText:"确认",cancelButtonText:"取消"}).then((function(){c["a"].back()})).catch((function(){}))},handleSelectTime:function(){this.timeShow=!0},handleConfirm:function(e){this.time=h()(e).format("YYYY-MM-DD HH:mm"),this.timeShow=!1},handleSelectReason:function(){var e=this;this.reasonShow=!0,this.reasonOptions=JSON.parse(localStorage.getItem("reason_options")).filter((function(t){return t.profession.findIndex((function(t){return e.profession&&t==e.profession.id}))>=0})),this.reasonRadio=g({},this.reason)},onReasonSelect:function(){this.reason=g({},this.reasonRadio),this.reasonShow=!1},handleSelectSource:function(){this.sourceShow=!0,this.sourceRadio=g({},this.reason)},onSourceSelect:function(){this.source=g({},this.sourceRadio),this.sourceShow=!1},handleSelectType:function(){var e=this;this.typeShow=!0,this.typeOptions=JSON.parse(localStorage.getItem("type_options")).filter((function(t){return t.profession.findIndex((function(t){return e.profession&&t==e.profession.id}))>=0})),this.typeRadio=g({},this.type)},onTypeSelect:function(){this.type=g({},this.typeRadio),this.typeShow=!1},handleSelectLevel:function(){var e=this;this.levelShow=!0,this.levelOptions=JSON.parse(localStorage.getItem("level_options")).filter((function(t){return t.profession.findIndex((function(t){return e.profession&&t==e.profession.id}))>=0})),this.levelRadio=g({},this.level)},onLevelSelect:function(){this.level=g({},this.levelRadio),this.levelShow=!1},handleSelectProfession:function(){this.professionShow=!0,this.professionRadio=g({},this.profession)},onProfessionSelect:function(){this.profession=g({},this.professionRadio),this.professionShow=!1},handlePhoto1:function(){var e=this;api.actionSheet({buttons:["打开照相机","从相册获取"]},(function(t,i){var o=t.buttonIndex,s="";1===o?s="camera":2===o&&(s="album"),s&&api.getPicture({sourceType:s,destinationType:"url",preview:!0,quality:80,mediaValue:"pic"},(function(t,i){t.data&&(e.imgFile=t.data,e.description="",e.editShow=!0,setTimeout((function(){e.$refs.desInput.focus()}),200))}))}))},handlePhoto2:function(){var e=this;api.actionSheet({buttons:["打开照相机","从相册获取"]},(function(t,i){var o=t.buttonIndex,s="";1===o?s="camera":2===o&&(s="album"),s&&api.getPicture({sourceType:s,destinationType:"url",preview:!0,quality:100,mediaValue:"video",saveToPhotoAlbum:!0,videoQuality:"high"},(function(t,i){t.data&&("ios"==api.systemType?(e.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在压缩..."}),e.videoCompression||(e.videoCompression=api.require("videoCompression")),e.videoCompression.compression({path:t.data,quality:"medium"},(function(t,i){"completed"==t.eventType&&(e.videoList.push({url:t.path}),e.$toast.clear())}))):e.videoList.push({url:t.data}))}))}))},beforeClose:function(e,t){"confirm"===e?this.imageList.push({url:this.imgFile,description:this.description}):this.imageList.push({url:this.imgFile,description:""}),t()},handleVideoRemove:function(e){this.videoList.splice(e,1)},handleImageRemove:function(e){this.imageList.splice(e,1)},handlePlayVideo:function(e){api.openVideo({url:e.url})},handlePlayImages:function(e){localStorage.setItem("photos",JSON.stringify(this.imageList)),c["a"].open("photoViewer",{index:e})},handleSelectDevice:function(){c["a"].open("device",{profession:this.profession&&this.profession.id?this.profession.id:""})},handleSelectLine:function(){c["a"].open("address")},handleSubmit:function(){var e=this;null!=this.profession&&null!=this.line&&null!=this.station&&""!=this.content&&this.deviceType?(this.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在提交..."}),f["a"].connection()?Object(v["b"])(this.imageList).then((function(t){e.imageList=t,Object(v["c"])(e.videoList).then((function(t){e.videoList=t,u["a"].createFault({profession:e.profession?e.profession.id:"",time:e.time,line:e.line?e.line.id:"",station:e.station?e.station.id:"",address:e.address,reason:e.reason?e.reason.id:"",type:e.type?e.type.id:"",level:e.level?e.level.id:"",source:e.source?e.source.id:"",content:e.content,images:JSON.stringify(e.imageList),videos:JSON.stringify(e.videoList),deviceId:e.device?e.device.id:"",deviceCategory:e.deviceType?e.deviceType.id:""}).then((function(t){e.localId?d["a"].removeMyFault(e.localId).then((function(){c["a"].back()})):c["a"].open("my_fault")})).catch((function(t){e.$toast(t)}))}))})):this.localId?d["a"].updateMyFault({profession:this.profession,time:this.time,line:this.line,station:this.station,address:this.address,reason:this.reason,type:this.type,level:this.level,source:this.source,content:this.content,images:this.imageList,videos:this.videoList,deviceId:this.device,deviceCategory:this.deviceType,id:this.localId}).then((function(){alert("无法连接到网络，数据已保存，可在【我提报的问题】中找到并提交数据"),c["a"].back()})).catch((function(t){e.$toast(t)})):d["a"].saveFault({profession:this.profession,time:this.time,line:this.line,station:this.station,address:this.address,reason:this.reason,type:this.type,level:this.level,source:this.source,content:this.content,images:this.imageList,videos:this.videoList,deviceId:this.device,deviceCategory:this.deviceType,id:(new Date).getTime()}).then((function(){alert("无法连接到网络，数据已保存，可在【我提报的问题】中找到并提交数据"),c["a"].open("my_fault")})).catch((function(t){e.$toast(t)}))):this.$toast.fail("请填写所有必填项")},handleSave:function(){var e=this;null==this.profession||null==this.line||null==this.station||""==this.content||""==this.deviceType?this.$toast.fail("请填写所有必填项"):this.localId?d["a"].updateMyFault({profession:this.profession,time:this.time,line:this.line,station:this.station,address:this.address,reason:this.reason,type:this.type,level:this.level,source:this.source,content:this.content,images:this.imageList,videos:this.videoList,deviceId:this.device,deviceCategory:this.deviceType,id:this.localId}).then((function(){alert("保存成功"),c["a"].open("my_fault")})).catch((function(t){e.$toast(t)})):d["a"].saveFault({profession:this.profession,time:this.time,line:this.line,station:this.station,address:this.address,reason:this.reason,type:this.type,level:this.level,source:this.source,content:this.content,images:this.imageList,videos:this.videoList,deviceId:this.device,deviceCategory:this.deviceType,id:(new Date).getTime()}).then((function(){alert("保存成功"),c["a"].open("my_fault")})).catch((function(t){e.$toast(t)}))},formatter:function(e,t){return"year"===e?"".concat(t,"年"):"month"===e?"".concat(t,"月"):"day"===e?"".concat(t,"日"):"hour"===e?"".concat(t,"时"):"minute"===e?"".concat(t,"分"):t}}},S=y,b=i("2877"),k=Object(b["a"])(S,o,s,!1,null,null,null),w=k.exports,_=i("a1db");_["a"].init(w)},6:function(e,t,i){e.exports=i("09c7")}});
//# sourceMappingURL=createFault.8301a090.js.map